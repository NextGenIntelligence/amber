;
; rowl - generation 1
; Copyright (C) 2010 nineties
;
; $Id: vm-eval.rlc 2010-06-04 01:07:06 nineties $
;


(var vm-eval-code `(

(int* sp)          ; stack pointer
(int stack_size)    ; in words
(int* stack)

(fun vm_init (stsize) (
    (+= stsize @BLOCK_SIZE)
    (&= stsize @BLOCK_MASK)
    (= stack (alloc_block stsize))
    (= stack_size stsize)
    (= sp stack)
    ))

(fun vm_eval (insns) (
    (byte code (fetch insns))
    (tswitch 1 (
        (0 ((= code 0) (break)))
        (1 ((= code 1)))
        ))
    ))

))
